<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²°ì •ì¥ì•  ëŒë¦¼íŒ</title>
    
    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="ê³ ë¯¼ ê·¸ë§Œ! ëŒë¦¼íŒì´ ê²°ì •í•´ë“œë¦´ê²Œìš” ğŸ¯ ëª¨ë°”ì¼ ìµœì í™”ëœ PWA ì•±">
    <meta name="keywords" content="ëŒë¦¼íŒ, ê²°ì •ì¥ì• , ì„ íƒ, ëœë¤, ê²°ì •, ë£°ë ›, PWA, ëª¨ë°”ì¼">
    <meta name="author" content="ê²°ì •ì¥ì•  ëŒë¦¼íŒ">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ëŒë¦¼íŒ">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Open Graph / ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ìµœì í™” -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="ê²°ì •ì¥ì•  ëŒë¦¼íŒ ğŸ¯">
    <meta property="og:description" content="ê²°ì •í•˜ê¸° í˜ë“¤ ë•? ëŒë¦¼íŒìœ¼ë¡œ ê²°ì •í•´ ë³´ì„¸ìš”! ëª¨ë°”ì¼ ìµœì í™”ëœ PWA ì•±">
    <meta property="og:image" content="https://raw.githubusercontent.com/5banjang/roulette/main/og_image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/png">
    <meta property="og:url" content="https://5banjang.github.io/roulette/">
    <meta property="og:site_name" content="ê²°ì •ì¥ì•  ëŒë¦¼íŒ">
    <meta property="og:locale" content="ko_KR">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ê²°ì •ì¥ì•  ëŒë¦¼íŒ ğŸ¯">
    <meta name="twitter:description" content="ê²°ì •í•˜ê¸° í˜ë“¤ ë•? ëŒë¦¼íŒìœ¼ë¡œ ê²°ì •í•´ ë³´ì„¸ìš”! ëª¨ë°”ì¼ ìµœì í™”ëœ PWA ì•±">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/5banjang/roulette/main/og_image.png">
    <meta name="twitter:image:alt" content="ê²°ì •ì¥ì•  ëŒë¦¼íŒ ì•± ìŠ¤í¬ë¦°ìƒ·">
    
    <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link rel="manifest" href="manifest.json">
    
    <!-- íŒŒë¹„ì½˜ ë° ì•„ì´ì½˜ -->
    <link rel="icon" type="image/png" href="icon-512x512.png">
    <link rel="apple-touch-icon" href="icon-512x512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-512x512.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
/* ê²°ì •ì¥ì•  ëŒë¦¼íŒ - ì „ë¬¸ê°€ê¸‰ ëª¨ë°”ì¼ PWA ìŠ¤íƒ€ì¼ */

/* ===================================== */
/* ğŸ’» ì „ì²´ ë ˆì´ì•„ì›ƒ & ë°˜ì‘í˜• ê¸°ë³¸ ì„¤ì • */
/* ===================================== */

/* ë¸Œë¼ìš°ì € ê¸°ë³¸ ì—¬ë°± ì œê±° */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ë¥¼ ìœ„í•œ ì¶”ê°€ ì„¤ì • */
*, *::before, *::after {
    max-width: 100%;
    word-wrap: break-word;
}

/* ì»¨í…Œì´ë„ˆ ë ˆì´ì•„ì›ƒ ìµœì í™” */
.min-h-screen {
    width: 100%;
    max-width: 100vw;
    overflow-x: hidden;
}

/* Flex ì»¨í…Œì´ë„ˆ ìµœì í™” */
.flex {
    min-width: 0; /* flex item ì¶•ì†Œ í—ˆìš© */
}

.flex-grow, .flex-1 {
    min-width: 0; /* flex-grow ì•„ì´í…œì´ ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šë„ë¡ */
}

html, body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background-color: #f3f4f6;
    overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ì›ì²œ ì°¨ë‹¨ */
    width: 100%;
    max-width: 100%;
}

/* ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ */
@media (max-width: 767px) {
    html, body {
        width: 100vw;
        height: 100vh;
        position: fixed;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: none;
        overflow-x: hidden;
    }
    
    body > div {
        width: 100vw;
        height: 100vh;
        overflow-y: auto;
        overflow-x: hidden;
    }
    
    /* ëª¨ë°”ì¼ì—ì„œ flex ì»¨í…Œì´ë„ˆ ìµœì í™” */
    .flex.flex-wrap {
        align-items: stretch;
    }
    
    /* ëª¨ë°”ì¼ì—ì„œ ì…ë ¥ì°½ ìµœì í™” */
    .flex-grow {
        min-width: 200px; /* ìµœì†Œ ë„ˆë¹„ ë³´ì¥ */
        flex-basis: 60%; /* ê¸°ë³¸ ë„ˆë¹„ ì„¤ì • */
    }
    
    /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ ìµœì í™” */
    .flex-1 {
        min-width: 90px; /* ë²„íŠ¼ ìµœì†Œ ë„ˆë¹„ */
        flex-basis: calc(33.333% - 8px); /* 3ê°œ ë²„íŠ¼ì´ í•œ ì¤„ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ */
    }
    
    /* ì‘ì€ í™”ë©´ì—ì„œ ë²„íŠ¼ë“¤ì´ ì„¸ë¡œë¡œ ë°°ì¹˜ë˜ë„ë¡ */
    @media (max-width: 360px) {
        .flex-1 {
            flex-basis: calc(50% - 8px); /* 2ê°œì”© ë°°ì¹˜ */
        }
    }
    
    @media (max-width: 280px) {
        .flex-1 {
            flex-basis: 100%; /* 1ê°œì”© ë°°ì¹˜ */
        }
    }
}

/* ë°ìŠ¤í¬í†± ìŠ¤íƒ€ì¼ */
@media (min-width: 768px) {
    html, body {
        min-height: 100vh;
        width: 100%;
    }
    
    body > div {
        min-height: 100vh;
        width: 100%;
        display: flex;
        flex-direction: column;
    }
}

/* ===================================== */
/* ğŸ“± ëª¨ë°”ì¼ í¼ìŠ¤íŠ¸ í„°ì¹˜ ìµœì í™” */
/* ===================================== */

/* ì „ì²´ì ì¸ í„°ì¹˜ ìµœì í™” */
* {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* í…ìŠ¤íŠ¸ ì…ë ¥ ìš”ì†ŒëŠ” ì„ íƒ ê°€ëŠ¥í•˜ê²Œ */
input, textarea {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
}

/* ===================================== */
/* ëŒë¦¼íŒ ìº”ë²„ìŠ¤ ìµœì í™” */
/* ===================================== */

#roulette-canvas {
    transform-origin: center center;
    transition: none;
    touch-action: none;
    width: min(70vw, 70vh, 320px);
    height: min(70vw, 70vh, 320px);
    max-width: 90vw;
    max-height: 50vh;
}

/* ì„¸ë¡œ í™”ë©´ ìµœì í™” */
@media (orientation: portrait) {
    #roulette-canvas {
        width: min(75vw, 40vh, 280px);
        height: min(75vw, 40vh, 280px);
    }
}

/* ê°€ë¡œ í™”ë©´ ìµœì í™” */
@media (orientation: landscape) {
    #roulette-canvas {
        width: min(50vw, 60vh, 300px);
        height: min(50vw, 60vh, 300px);
    }
}

/* ì´ˆì†Œí˜• í™”ë©´ (320px ì´í•˜) */
@media (max-width: 320px) {
    #roulette-canvas {
        width: 70vw;
        height: 70vw;
        max-width: 240px;
        max-height: 240px;
    }
}

/* ë°ìŠ¤í¬í†±ì—ì„œ ì¶”ê°€ ì—¬ë°± */
@media (min-width: 768px) {
    .arrow-pointer {
        border-left: 16px solid transparent;
        border-right: 16px solid transparent;
        border-top: 50px solid #ef4444;
    }
    
    .arrow-pointer::after {
        top: -46px;
        left: -12px;
        border-left: 12px solid transparent;
        border-right: 12px solid transparent;
        border-top: 38px solid #dc2626;
    }
}

/* ===================================== */
/* ëª¨ë°”ì¼ ìµœì í™” í™”ì‚´í‘œ */
/* ===================================== */

.arrow-pointer {
    width: 0;
    height: 0;
    border-left: 14px solid transparent;
    border-right: 14px solid transparent;
    border-top: 45px solid #ef4444;
    position: relative;
    filter: drop-shadow(0 4px 8px rgba(239, 68, 68, 0.4));
    animation: arrow-pulse 2s ease-in-out infinite;
    transition: all 0.3s ease;
}

/* í™”ì‚´í‘œ ë‚´ë¶€ í…Œë‘ë¦¬ íš¨ê³¼ */
.arrow-pointer::after {
    content: '';
    position: absolute;
    top: -42px;
    left: -10px;
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-top: 35px solid #dc2626;
}

/* ëŒë¦¬ëŠ” ì¤‘ í™”ì‚´í‘œ */
.arrow-pointer.spinning {
    animation: none;
    transform: scale(0.85);
    filter: drop-shadow(0 2px 6px rgba(239, 68, 68, 0.3));
}

/* ê²°ê³¼ í™•ì •ì‹œ í™”ì‚´í‘œ ê°•ì¡° */
.arrow-pointer.result {
    animation: arrow-result 0.7s ease-in-out 3;
    transform: scale(1.3);
}

/* í™”ì‚´í‘œ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes arrow-pulse {
    0%, 100% {
        transform: scale(1);
        filter: drop-shadow(0 4px 8px rgba(239, 68, 68, 0.4));
    }
    50% {
        transform: scale(1.1);
        filter: drop-shadow(0 6px 12px rgba(239, 68, 68, 0.6));
    }
}

@keyframes arrow-result {
    0%, 100% {
        transform: scale(1.3);
        filter: drop-shadow(0 6px 15px rgba(239, 68, 68, 0.8));
    }
    50% {
        transform: scale(1.5);
        filter: drop-shadow(0 8px 20px rgba(239, 68, 68, 1));
    }
}

/* ===================================== */
/* í„°ì¹˜ ì¹œí™”ì ì¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
/* ===================================== */

/* ëª¨ë°”ì¼ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
@media (max-width: 767px) {
    button {
        min-height: max(48px, 8vh);
        touch-action: manipulation;
        -webkit-appearance: none;
        appearance: none;
        font-size: clamp(0.875rem, 4vw, 1.125rem);
        padding: clamp(0.75rem, 3vw, 1rem) clamp(1rem, 4vw, 1.5rem);
    }

    #spin-button, #reset-button, #share-button {
        font-size: clamp(1rem, 4.5vw, 1.25rem);
        min-height: max(60px, 10vh);
    }
}

/* ê¸°ë³¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
button {
    touch-action: manipulation;
    -webkit-appearance: none;
    appearance: none;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 600;
}

/* í„°ì¹˜ í”¼ë“œë°± íš¨ê³¼ */
button:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
}

/* ===================================== */
/* í•­ëª© íƒœê·¸ ëª¨ë°”ì¼ ìµœì í™” */
/* ===================================== */

.item-tag {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    transition: all 0.2s ease;
    min-height: 44px; /* í„°ì¹˜ ìµœì†Œ í¬ê¸° */
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.item-tag:active {
    transform: scale(0.98);
}

/* ì‚­ì œ ë²„íŠ¼ í„°ì¹˜ ìµœì í™” */
.remove-btn {
    background: rgba(255, 255, 255, 0.25);
    border: none;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: white;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.2s ease;
    min-width: 44px; /* í„°ì¹˜ ì˜ì—­ í™•ëŒ€ */
    min-height: 44px;
    margin: -8px; /* ì‹œê°ì  í¬ê¸°ëŠ” ìœ ì§€í•˜ë˜ í„°ì¹˜ ì˜ì—­ í™•ëŒ€ */
}

.remove-btn:active {
    background: rgba(255, 255, 255, 0.4);
    transform: scale(0.9);
}

/* ===================================== */
/* ì¦ê²¨ì°¾ê¸° ì•„ì´í…œ ëª¨ë°”ì¼ ìµœì í™” */
/* ===================================== */

.load-favorite-btn,
.delete-favorite-btn {
    min-height: 44px;
    padding: 0.75rem 1rem;
    font-size: 0.9rem;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.2s ease;
}

.load-favorite-btn:active,
.delete-favorite-btn:active {
    transform: scale(0.95);
}

/* ===================================== */
/* ê²°ê³¼ í‘œì‹œ ëª¨ë°”ì¼ ìµœì í™” */
/* ===================================== */

.result-highlight {
    background: linear-gradient(135deg, #ffeaa7, #fab1a0);
    color: #2d3436;
    padding: 1.5rem 2rem;
    border-radius: 16px;
    font-weight: bold;
    font-size: 1.25rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    animation: mobile-bounce 0.6s ease-in-out;
    text-align: center;
    min-height: 4rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

@keyframes mobile-bounce {
    0%, 20%, 60%, 100% {
        transform: translateY(0) scale(1);
    }
    40% {
        transform: translateY(-8px) scale(1.02);
    }
    80% {
        transform: translateY(-3px) scale(1.01);
    }
}

/* ===================================== */
/* ì…ë ¥ í•„ë“œ ìµœì í™” */
/* ===================================== */

/* ëª¨ë°”ì¼ ì…ë ¥ í•„ë“œ */
@media (max-width: 767px) {
    input[type="text"] {
        font-size: max(16px, 4vw); /* iOS ì¤Œ ë°©ì§€ + ë°˜ì‘í˜• */
        min-height: max(48px, 8vh);
        padding: clamp(0.75rem, 3vw, 1rem);
        border-radius: clamp(0.5rem, 2vw, 0.75rem);
    }

    #result {
        font-size: clamp(1rem, 4.5vw, 1.25rem);
        min-height: max(4rem, 12vh);
        padding: clamp(1rem, 4vw, 1.5rem);
    }
}

/* ê¸°ë³¸ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
input[type="text"] {
    -webkit-appearance: none;
    appearance: none;
    border: 2px solid #e5e7eb;
    border-radius: 0.75rem;
    transition: all 0.2s ease;
    outline: none;
}

input[type="text"]:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

#result {
    background: #f9fafb;
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

/* ===================================== */
/* ğŸ“ ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ & ì„¹ì…˜ í¬ê¸° ì¡°ì • */
/* ===================================== */

/* ëª¨ë°”ì¼ ì „ìš© í—¤ë”/ë©”ì¸/í‘¸í„° */
@media (max-width: 767px) {
    header {
        height: max(60px, 8vh);
        min-height: 50px;
        padding: clamp(0.5rem, 2vh, 1rem) clamp(1rem, 4vw, 1.5rem);
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
    }

    header h1 {
        font-size: clamp(1.125rem, 5vw, 1.5rem);
        width: 100%;
        max-width: 100%;
        word-wrap: break-word;
    }

    main {
        padding: clamp(0.75rem, 3vw, 1.5rem);
        padding-left: max(clamp(0.75rem, 3vw, 1.5rem), env(safe-area-inset-left));
        padding-right: max(clamp(0.75rem, 3vw, 1.5rem), env(safe-area-inset-right));
        padding-bottom: max(clamp(1rem, 4vh, 2rem), env(safe-area-inset-bottom));
        gap: clamp(0.75rem, 3vh, 1.5rem);
        height: calc(100vh - max(60px, 8vh) - max(40px, 6vh));
        overflow-y: auto;
        overflow-x: hidden;
        width: 100%;
        max-width: 100%;
    }

    section {
        padding: clamp(1rem, 4vw, 1.5rem);
        border-radius: clamp(0.75rem, 3vw, 1rem);
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
    }
    
    /* ëª¨ë°”ì¼ì—ì„œ flex ì»¨í…Œì´ë„ˆì™€ ì•„ì´í…œë“¤ì˜ ê°„ê²© ì¡°ì • */
    .flex.flex-wrap.justify-center {
        margin: 0 -0.25rem; /* ìŒìˆ˜ ë§ˆì§„ìœ¼ë¡œ ì¢Œìš° ê³µê°„ í™•ë³´ */
    }
    
    .mx-1 {
        margin-left: 0.25rem;
        margin-right: 0.25rem;
    }

    footer {
        height: max(40px, 6vh);
        min-height: 30px;
        padding: clamp(0.5rem, 2vh, 0.75rem);
        font-size: clamp(0.75rem, 3vw, 0.875rem);
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
    }
}

/* ê¸°ë³¸ ë°ìŠ¤í¬í†± ìŠ¤íƒ€ì¼ */
header {
    padding: 1rem;
    background: linear-gradient(135deg, #10b981, #3b82f6);
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
}

header h1 {
    font-size: 1.5rem;
    color: white;
    text-align: center;
    font-weight: bold;
}

main {
    padding: 1.5rem;
    gap: 1.5rem;
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
}

section {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    padding: 1.5rem;
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
}

footer {
    padding: 1rem;
    text-align: center;
    color: #9ca3af;
    font-size: 0.875rem;
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
}

/* ë°ìŠ¤í¬í†± ë ˆì´ì•„ì›ƒ ìµœì í™” */
@media (min-width: 768px) {
    header {
        height: auto;
        padding: 1.5rem 2rem;
    }
    
    header h1 {
        font-size: 1.75rem;
        max-width: 600px;
        margin: 0 auto;
    }
    
    main {
        max-width: 600px;
        margin: 0 auto;
        padding: 2rem;
        gap: 2rem;
        height: auto;
        min-height: calc(100vh - 200px);
        flex: 1;
        width: 100%;
        overflow-x: hidden;
    }
    
    section {
        padding: 2rem;
        border-radius: 1rem;
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
    }
    
    /* ë°ìŠ¤í¬í†±ì—ì„œ flex ì»¨í…Œì´ë„ˆ ì¡°ì • */
    .flex.flex-wrap.justify-center {
        justify-content: flex-start; /* ë°ìŠ¤í¬í†±ì—ì„œëŠ” ì™¼ìª½ ì •ë ¬ */
        margin: 0;
    }
    
    /* ë°ìŠ¤í¬í†±ì—ì„œëŠ” ë²„íŠ¼ë“¤ì´ ì ë‹¹í•œ í¬ê¸°ë¥¼ ìœ ì§€í•˜ë„ë¡ */
    .flex-1[class*="min-w-"] {
        flex: 0 1 auto; /* ë°ìŠ¤í¬í†±ì—ì„œëŠ” ê³ ì • í¬ê¸° */
        max-width: none;
    }
    
    footer {
        height: auto;
        padding: 1rem;
        margin-top: auto;
    }
    
    footer > div {
        max-width: 600px;
        margin: 0 auto;
    }
    
    /* ë°ìŠ¤í¬í†±ì—ì„œ ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì • */
    #roulette-canvas {
        width: 350px;
        height: 350px;
        max-width: 350px;
        max-height: 350px;
    }
    
    /* ë²„íŠ¼ í¬ê¸° ì¡°ì • */
    button {
        font-size: 1rem;
        min-height: 48px;
        padding: 0.75rem 1.5rem;
    }
    
    #spin-button, #reset-button, #share-button {
        font-size: 1.125rem;
        min-height: 56px;
        padding: 1rem 2rem;
    }
    
    /* ì…ë ¥ í•„ë“œ í¬ê¸° ì¡°ì • */
    input[type="text"] {
        font-size: 1rem;
        min-height: 48px;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
    }
    
    /* ê²°ê³¼ í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
    #result {
        font-size: 1.25rem;
        min-height: 4rem;
        padding: 1.5rem;
    }
    
    /* ì•„ì´í…œ íƒœê·¸ í¬ê¸° ì¡°ì • */
    .item-tag {
        font-size: 1rem;
        padding: 0.75rem 1rem;
        min-height: auto;
    }
    
    .remove-btn {
        width: 24px;
        height: 24px;
        min-width: 24px;
        min-height: 24px;
        margin: 0;
        font-size: 14px;
    }
}

/* í‚¤ë³´ë“œ ì˜¬ë¼ì˜¬ ë•Œ ëŒ€ì‘ */
@media (max-height: 600px) and (orientation: portrait) {
    main {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
    }
    
    main > section {
        margin-bottom: 0.75rem;
    }
}

/* ===================================== */
/* ë‹¤í¬ëª¨ë“œ ëŒ€ì‘ */
/* ===================================== */

@media (prefers-color-scheme: dark) {
    body {
        background-color: #1f2937;
    }
    
    section {
        background-color: #374151 !important;
        color: white;
    }
    
    input[type="text"] {
        background-color: #4b5563;
        color: white;
        border-color: #6b7280;
    }
    
    input[type="text"]::placeholder {
        color: #9ca3af;
    }
    
    .result-highlight {
        background: linear-gradient(135deg, #f59e0b, #ef4444);
        color: white;
    }
}

/* ===================================== */
/* ì ‘ê·¼ì„± */
/* ===================================== */

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* ê³ ëŒ€ë¹„ ëª¨ë“œ ëŒ€ì‘ */
@media (prefers-contrast: high) {
    .item-tag {
        border: 2px solid white;
    }
    
    button {
        border: 2px solid currentColor;
    }
}

/* ì›€ì§ì„ ì¤„ì´ê¸° ì„¤ì • ì‹œ ì• ë‹ˆë©”ì´ì…˜ ë¹„í™œì„±í™” */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
}
    </style>
</head>
<body>
    <div class="min-h-screen bg-gray-100" style="width: 100%; max-width: 100vw; overflow-x: hidden;">
        <!-- ì»´íŒ©íŠ¸í•œ í—¤ë” -->
        <header class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-4 md:px-8 py-3 md:py-6 shadow-lg">
            <div class="max-w-full md:max-w-2xl mx-auto" style="width: 100%; max-width: 100%; overflow-x: hidden;">
                <h1 class="text-xl md:text-3xl font-bold text-center">
                    ğŸ¯ ê²°ì •ì¥ì•  ëŒë¦¼íŒ
                </h1>
            </div>
        </header>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ - ë°˜ì‘í˜• ì»¨í…Œì´ë„ˆ -->
        <main class="max-w-full md:max-w-2xl mx-auto p-4 md:p-8 space-y-4 md:space-y-6 min-h-[calc(100vh-60px)] md:min-h-0 flex flex-col" style="width: 100%; max-width: 100%; overflow-x: hidden;">
            <!-- í•­ëª© ì…ë ¥ ì„¹ì…˜ -->
            <section class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <div class="flex flex-wrap justify-center gap-2 md:gap-3 mb-3 md:mb-4">
                    <input 
                        type="text" 
                        id="item-input"
                        placeholder="í•­ëª© ì…ë ¥ (ì˜ˆ: ì¹˜í‚¨)"
                        class="flex-grow min-w-0 px-4 py-3 md:px-5 md:py-4 text-lg md:text-xl border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 mx-1"
                        aria-label="ëŒë¦¼íŒì— ì¶”ê°€í•  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                    />
                    <button 
                        type="button"
                        id="add-button"
                        class="px-6 py-3 md:px-8 md:py-4 bg-blue-500 text-white font-semibold rounded-xl hover:bg-blue-600 active:bg-blue-700 transition-colors min-w-[80px] md:min-w-[100px] text-lg md:text-xl mx-1"
                        aria-label="í•­ëª© ì¶”ê°€"
                    >
                        â•
                    </button>
                </div>
            
                <!-- ì¶”ê°€ëœ í•­ëª©ë“¤ -->
                <div id="items-list" class="flex flex-wrap gap-2">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </section>
            
            <!-- ì¦ê²¨ì°¾ê¸° ì„¹ì…˜ -->
            <section class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <div class="flex items-center gap-2 mb-3 md:mb-4">
                    <span class="text-lg md:text-xl font-semibold">ğŸ’¾</span>
                    <h3 class="text-lg md:text-xl font-semibold text-gray-800">ì¦ê²¨ì°¾ê¸°</h3>
                </div>
                
                <!-- ì €ì¥ ì˜ì—­ -->
                <div class="flex flex-wrap justify-center gap-2 md:gap-3 mb-4 md:mb-6">
                    <input 
                        type="text" 
                        id="favorite-name-input"
                        placeholder="ëŒë¦¼íŒ ì´ë¦„"
                        class="flex-grow min-w-0 px-4 py-3 md:px-5 md:py-4 text-lg md:text-xl border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-100 mx-1"
                    />
                    <button 
                        type="button"
                        id="save-favorite-button"
                        class="px-6 py-3 md:px-8 md:py-4 bg-purple-500 text-white font-semibold rounded-xl hover:bg-purple-600 active:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed min-w-[80px] md:min-w-[100px] text-lg md:text-xl mx-1"
                        disabled
                    >
                        ğŸ’¾
                    </button>
                </div>
                
                <!-- ì €ì¥ëœ ì¦ê²¨ì°¾ê¸° ëª©ë¡ -->
                <div id="favorites-list" class="space-y-2">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
                
                <!-- ì „ì²´ ì‚­ì œ ë²„íŠ¼ -->
                <button 
                    type="button"
                    id="clear-all-favorites-button"
                    class="w-full mt-3 py-2 text-red-500 text-sm font-medium hover:bg-red-50 rounded-lg transition-colors"
                    style="display: none;"
                >
                    ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ
                </button>
            </section>

            <!-- ëŒë¦¼íŒ ì„¹ì…˜ - ë©”ì¸ ì˜ì—­ -->
            <section class="bg-white rounded-xl shadow-lg p-4 md:p-8 flex-1 flex flex-col justify-center">
                <!-- ìº”ë²„ìŠ¤ ì˜ì—­ -->
                <div class="flex justify-center mb-4 md:mb-8 relative">
                    <!-- ê³ ì • í™”ì‚´í‘œ -->
                    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 z-20">
                        <div class="arrow-pointer"></div>
                    </div>
                    
                    <canvas 
                        id="roulette-canvas"
                        width="280"
                        height="280"
                        class="border-4 border-gray-200 rounded-full shadow-lg relative z-10 max-w-full"
                        aria-label="ëŒë¦¼íŒ ì˜ì—­"
                    >
                        ëŒë¦¼íŒì„ í‘œì‹œí•˜ë ¤ë©´ JavaScriptê°€ í•„ìš”í•©ë‹ˆë‹¤.
                    </canvas>
                </div>

                <!-- ëŒë¦¬ê¸°, ë¦¬ì…‹, ê³µìœ  ë²„íŠ¼ -->
                <div class="flex flex-wrap justify-center gap-3 md:gap-6">
                    <button 
                        type="button"
                        id="spin-button"
                        class="flex-1 min-w-[100px] max-w-[200px] py-4 md:py-6 bg-green-500 text-white text-lg md:text-xl font-bold rounded-xl hover:bg-green-600 active:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-lg mx-1"
                        aria-label="ëŒë¦¼íŒ ëŒë¦¬ê¸°"
                        disabled
                    >
                        <div class="flex items-center justify-center gap-2">
                            <span class="text-xl md:text-2xl">ğŸ¯</span>
                            <span class="hidden sm:inline">ëŒë¦¬ê¸°!</span>
                            <span class="sm:hidden">ëŒë¦¬ê¸°</span>
                        </div>
                    </button>
                    <button 
                        type="button"
                        id="reset-button"
                        class="flex-1 min-w-[100px] max-w-[200px] py-4 md:py-6 bg-red-500 text-white text-lg md:text-xl font-bold rounded-xl hover:bg-red-600 active:bg-red-700 transition-colors shadow-lg mx-1"
                        aria-label="ëŒë¦¼íŒ ë¦¬ì…‹í•˜ê¸°"
                    >
                        <div class="flex items-center justify-center gap-2">
                            <span class="text-xl md:text-2xl">ğŸ”„</span>
                            <span>ë¦¬ì…‹</span>
                        </div>
                    </button>
                    <button 
                        type="button"
                        id="share-button"
                        class="flex-1 min-w-[100px] max-w-[200px] py-4 md:py-6 bg-blue-500 text-white text-lg md:text-xl font-bold rounded-xl hover:bg-blue-600 active:bg-blue-700 transition-colors shadow-lg mx-1"
                        aria-label="ëŒë¦¼íŒ ë§í¬ ë³µì‚¬"
                    >
                        <div class="flex items-center justify-center gap-2">
                            <span class="text-xl md:text-2xl">ğŸ”—</span>
                            <span>ê³µìœ </span>
                        </div>
                    </button>
                </div>
            </section>

            <!-- ê²°ê³¼ ì„¹ì…˜ -->
            <section class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <div class="flex items-center gap-2 mb-3 md:mb-4">
                    <span class="text-lg md:text-xl font-semibold">ğŸ¯</span>
                    <h3 class="text-lg md:text-xl font-semibold text-gray-800">ê²°ê³¼</h3>
                </div>
                <div 
                    id="result"
                    class="text-center text-lg md:text-xl text-gray-600 min-h-[4rem] md:min-h-[5rem] flex items-center justify-center bg-gray-50 rounded-xl p-4 md:p-6"
                    aria-live="polite"
                    aria-label="ëŒë¦¼íŒ ê²°ê³¼"
                >
                    í•­ëª©ì„ ì¶”ê°€í•˜ê³  ëŒë¦¼íŒì„ ëŒë ¤ë³´ì„¸ìš”!
                </div>
            </section>
        </main>

        <!-- ì»´íŒ©íŠ¸í•œ í‘¸í„° -->
        <footer class="text-center py-3 md:py-6 text-gray-400 text-sm md:text-base">
            <div class="max-w-full md:max-w-2xl mx-auto" style="width: 100%; max-width: 100%; overflow-x: hidden;">
                ğŸ’« ê²°ì •ì¥ì•  í•´ê²°ì‚¬
            </div>
        </footer>
    </div>

    <script>
// ===================================================================
// ê²°ì •ì¥ì•  ëŒë¦¼íŒ - ìµœì¢… ì™„ë²½ ë²„ì „
// ì„¤ê³„: ìˆ˜í•™ì ìœ¼ë¡œ ì™„ë²½í•œ ê³„ì‚°ì‹ + ì™„ì „ ë¶„ë¦¬ëœ ë¡œì§ + ë¦¬ì…‹ ê¸°ëŠ¥
// ===================================================================

// [1. ê¸°ë³¸ ë³€ìˆ˜ ë° ìƒíƒœ ì„¤ì •]
// DOM ìš”ì†Œë“¤ ê°€ì ¸ì˜¤ê¸°
const canvas = document.getElementById('roulette-canvas');
const ctx = canvas.getContext('2d');
const itemInput = document.getElementById('item-input');
const addButton = document.getElementById('add-button');
const spinButton = document.getElementById('spin-button');
const resetButton = document.getElementById('reset-button');
const itemsList = document.getElementById('items-list');
const resultElement = document.getElementById('result');
const arrowPointer = document.querySelector('.arrow-pointer');

// ì¦ê²¨ì°¾ê¸° ê´€ë ¨ DOM ìš”ì†Œë“¤
const favoriteNameInput = document.getElementById('favorite-name-input');
const saveFavoriteButton = document.getElementById('save-favorite-button');
const favoritesList = document.getElementById('favorites-list');
const clearAllFavoritesButton = document.getElementById('clear-all-favorites-button');

// ìƒíƒœ ë³€ìˆ˜ë“¤
let items = []; // í•­ëª© ë°°ì—´
let currentRotation = 0; // í˜„ì¬ ëŒë¦¼íŒì˜ ì´ íšŒì „ ê°ë„ (ë¼ë””ì•ˆ)
let isSpinning = false; // íšŒì „ ì¤‘ë³µ ë°©ì§€ í”Œë˜ê·¸
let animationId = null; // ì• ë‹ˆë©”ì´ì…˜ ID
let preSelectedWinner = null; // ë¯¸ë¦¬ ê²°ì •ëœ ìŠ¹ì

// ===================================================================
// ğŸš€ ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ìë™ ì „í™˜ ê¸°ëŠ¥
// ===================================================================

// ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€ ë° ì™¸ë¶€ ë¸Œë¼ìš°ì €ë¡œ ì „í™˜
const handleKakaoInAppBrowser = () => {
    const userAgent = navigator.userAgent || navigator.vendor || window.opera;
    const isKakaoTalk = userAgent.includes('KAKAOTALK');
    
    if (isKakaoTalk) {
        console.log('ğŸ” ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€ë¨');
        
        // iOS/Android êµ¬ë¶„
        const isIOS = /iPad|iPhone|iPod/.test(userAgent);
        const isAndroid = /Android/.test(userAgent);
        
        if (isAndroid) {
            // ì•ˆë“œë¡œì´ë“œ: Chrome Intent URLë¡œ ìë™ ì „í™˜
            console.log('ğŸ“± ì•ˆë“œë¡œì´ë“œ - Chromeìœ¼ë¡œ ìë™ ì „í™˜ ì‹œë„');
            const currentUrl = encodeURIComponent(window.location.href);
            const chromeIntent = `intent://${window.location.host}${window.location.pathname}${window.location.search}#Intent;scheme=https;package=com.android.chrome;end`;
            
            try {
                window.location.href = chromeIntent;
                // 2ì´ˆ í›„ì—ë„ ì¹´ì¹´ì˜¤í†¡ì— ìˆë‹¤ë©´ ìˆ˜ë™ ì•ˆë‚´
                setTimeout(() => {
                    if (userAgent.includes('KAKAOTALK')) {
                        showExternalBrowserGuide('Android');
                    }
                }, 2000);
            } catch (error) {
                console.warn('Chrome Intent ì‹¤í–‰ ì‹¤íŒ¨:', error);
                showExternalBrowserGuide('Android');
            }
        } else if (isIOS) {
            // iOS: ìˆ˜ë™ ì•ˆë‚´ (ìë™ ì „í™˜ ë¶ˆê°€)
            console.log('ğŸ iOS - Safari ì „í™˜ ì•ˆë‚´ í‘œì‹œ');
            showExternalBrowserGuide('iOS');
        } else {
            // ê¸°íƒ€ í”Œë«í¼
            showExternalBrowserGuide('ê¸°íƒ€');
        }
        
        return true; // ì¹´ì¹´ì˜¤í†¡ ë¸Œë¼ìš°ì €ì„ì„ ë°˜í™˜
    }
    
    return false; // ì¼ë°˜ ë¸Œë¼ìš°ì €ì„ì„ ë°˜í™˜
};

// ì™¸ë¶€ ë¸Œë¼ìš°ì € ì´ìš© ì•ˆë‚´ í‘œì‹œ
const showExternalBrowserGuide = (platform) => {
    const messages = {
        'Android': 'ğŸ“± ë” ë‚˜ì€ ì´ìš©ì„ ìœ„í•´ Chrome ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”!\n\n1. ìš°ì¸¡ ìƒë‹¨ â‹® ë©”ë‰´ í´ë¦­\n2. "ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°" ì„ íƒ\n3. Chrome ì„ íƒ',
        'iOS': 'ğŸ ë” ë‚˜ì€ ì´ìš©ì„ ìœ„í•´ Safariì—ì„œ ì—´ì–´ì£¼ì„¸ìš”!\n\n1. ìš°ì¸¡ í•˜ë‹¨ Safari ì•„ì´ì½˜ í´ë¦­\në˜ëŠ”\n1. ìš°ì¸¡ ìƒë‹¨ â‹¯ ë©”ë‰´ í´ë¦­\n2. "Safariì—ì„œ ì—´ê¸°" ì„ íƒ',
        'ê¸°íƒ€': 'ğŸŒ ë” ë‚˜ì€ ì´ìš©ì„ ìœ„í•´ ê¸°ë³¸ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”!\n\nì¹´ì¹´ì˜¤í†¡ ë‚´ì¥ ë¸Œë¼ìš°ì €ì—ì„œëŠ”\nì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
    };
    
    const message = messages[platform] || messages['ê¸°íƒ€'];
    
    // ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ì•Œë¦¼ì°½ ìƒì„±
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        padding: 20px;
        box-sizing: border-box;
    `;
    
    const content = document.createElement('div');
    content.style.cssText = `
        background: white;
        border-radius: 16px;
        padding: 24px;
        max-width: 90%;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    `;
    
    // ì•ˆì „í•˜ê²Œ ìš”ì†Œ ìƒì„±
    const iconDiv = document.createElement('div');
    iconDiv.style.cssText = 'font-size: 1.5rem; margin-bottom: 16px;';
    iconDiv.textContent = 'ğŸ¯';
    
    const titleH3 = document.createElement('h3');
    titleH3.style.cssText = 'margin: 0 0 16px 0; font-size: 1.2rem; color: #333;';
    titleH3.textContent = 'ê²°ì •ì¥ì•  ëŒë¦¼íŒ';
    
    const messageP = document.createElement('p');
    messageP.style.cssText = 'margin: 0 0 20px 0; line-height: 1.5; color: #666; white-space: pre-line;';
    messageP.textContent = message; // XSS ë°©ì§€ë¥¼ ìœ„í•´ textContent ì‚¬ìš©
    
    const confirmBtn = document.createElement('button');
    confirmBtn.style.cssText = 'background: #4CAF50; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer;';
    confirmBtn.textContent = 'í™•ì¸';
    confirmBtn.addEventListener('click', () => modal.remove());
    
    content.appendChild(iconDiv);
    content.appendChild(titleH3);
    content.appendChild(messageP);
    content.appendChild(confirmBtn);
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ì•Œë¦¼ì°½ ì œê±° (ì„ íƒì‚¬í•­)
    setTimeout(() => {
        if (modal && modal.parentElement) {
            modal.remove();
        }
    }, 10000);
};

// ë°˜ì‘í˜• ìº”ë²„ìŠ¤ í¬ê¸° ê³„ì‚° (ìƒëŒ€ ë‹¨ìœ„ ì ìš©)
const initializeCanvas = () => {
    const isDesktop = window.innerWidth >= 768;
    
    // í™”ë©´ í¬ê¸°ì— ë”°ë¥¸ ë™ì  í¬ê¸° ê³„ì‚°
    let maxSize;
    
    if (isDesktop) {
        // ë°ìŠ¤í¬í†±: ê³ ì • í¬ê¸°ë¡œ ì•ˆì •ì ì¸ í‘œì‹œ
        maxSize = 350;
    } else {
        // ëª¨ë°”ì¼: ë·°í¬íŠ¸ ê¸°ì¤€ ìƒëŒ€ í¬ê¸°
        const containerWidth = canvas.parentElement.clientWidth;
        maxSize = Math.min(
            containerWidth - 40,
            Math.min(window.innerWidth * 0.7, window.innerHeight * 0.35),
            280
        );
    }
    
    canvas.width = maxSize;
    canvas.height = maxSize;
    canvas.style.width = maxSize + 'px';
    canvas.style.height = maxSize + 'px';
    
    return {
        centerX: maxSize / 2,
        centerY: maxSize / 2,
        radius: maxSize / 2 - 20
    };
};

// ìº”ë²„ìŠ¤ í¬ê¸° ì •ë³´ (ë™ì ìœ¼ë¡œ ê³„ì‚°)
let canvasInfo = initializeCanvas();

// ===================================================================
// [2. drawRoulette() í•¨ìˆ˜: ì˜¤ì§ ê·¸ë¦¬ê¸°ë§Œ ë‹´ë‹¹]
// ì—­í• : currentRotation ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ í˜„ì¬ ìƒíƒœì˜ ëŒë¦¼íŒì„ ê·¸ë¦¬ê¸°
// ===================================================================
const drawRoulette = () => {
    // ìº”ë²„ìŠ¤ í´ë¦¬ì–´
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    if (items.length === 0) {
        // ë¹ˆ ìƒíƒœ í‘œì‹œ
        drawEmptyWheel();
        return;
    }
    
    // ì¢Œí‘œê³„ ë³€í™˜: ctx.save(), ctx.translate(), ctx.rotate(), ctx.restore() íŒ¨í„´
    ctx.save();
    
    // ìº”ë²„ìŠ¤ ì¤‘ì‹¬ìœ¼ë¡œ ì¢Œí‘œ ì´ë™
    ctx.translate(canvasInfo.centerX, canvasInfo.centerY);
    
    // currentRotationë§Œí¼ ìº”ë²„ìŠ¤ ìì²´ë¥¼ íšŒì „
    ctx.rotate(currentRotation);
    
    // ì¡°ê° ê·¸ë¦¬ê¸°: items ë°°ì—´ì„ ìˆœíšŒí•˜ë©° ê° ì¡°ê°ì˜ ìƒ‰ìƒê³¼ í…ìŠ¤íŠ¸ë¥¼ ì •í™•í•œ ìœ„ì¹˜ì— ê·¸ë¦¬ê¸°
    const sliceAngle = (2 * Math.PI) / items.length;
    
    items.forEach((item, index) => {
        // ê° ì¡°ê°ì˜ ì‹œì‘ê³¼ ë ê°ë„ ê³„ì‚° (12ì‹œ ë°©í–¥ë¶€í„° ì‹œì‘)
        const startAngle = index * sliceAngle - Math.PI / 2;
        const endAngle = (index + 1) * sliceAngle - Math.PI / 2;
        
        // ì¡°ê° ìƒ‰ìƒ ìƒì„±
        const hue = (index * 360 / items.length) % 360;
        const sliceColor = `hsl(${hue}, 70%, 60%)`;
        
        // ì¡°ê° ê·¸ë¦¬ê¸°
        drawSlice(startAngle, endAngle, sliceColor);
        
        // í…ìŠ¤íŠ¸ë¥¼ ì¡°ê°ì˜ ì¤‘ì•™ì— ì˜¬ë°”ë¥¸ ë°©í–¥ìœ¼ë¡œ ê·¸ë¦¬ê¸°
        const textAngle = startAngle + sliceAngle / 2;
        drawSliceText(item, textAngle);
    });
    
    // ì¤‘ì•™ ì› ê·¸ë¦¬ê¸°
    drawCenterCircle();
    
    // ì¢Œí‘œê³„ ë³µì›
    ctx.restore();
};

// ë¹ˆ ëŒë¦¼íŒ ê·¸ë¦¬ê¸°
const drawEmptyWheel = () => {
    ctx.fillStyle = '#f3f4f6';
    ctx.beginPath();
    ctx.arc(canvasInfo.centerX, canvasInfo.centerY, canvasInfo.radius, 0, 2 * Math.PI);
    ctx.fill();
    
    ctx.fillStyle = '#9ca3af';
    ctx.font = `${Math.max(14, canvasInfo.radius / 10)}px sans-serif`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('í•­ëª©ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”', canvasInfo.centerX, canvasInfo.centerY);
};

// ê°œë³„ ì¡°ê° ê·¸ë¦¬ê¸°
const drawSlice = (startAngle, endAngle, color) => {
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.arc(0, 0, canvasInfo.radius, startAngle, endAngle);
    ctx.closePath();
    ctx.fill();
    
    // í…Œë‘ë¦¬ ê·¸ë¦¬ê¸°
    ctx.strokeStyle = '#ffffff';
    ctx.lineWidth = Math.max(2, canvasInfo.radius / 60);
    ctx.stroke();
};

// ì¡°ê° í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸° (ì •í™•í•œ ìœ„ì¹˜ì™€ ë°©í–¥)
const drawSliceText = (text, textAngle) => {
    const textRadius = canvasInfo.radius * 0.75;
    const textX = Math.cos(textAngle) * textRadius;
    const textY = Math.sin(textAngle) * textRadius;
    
    ctx.save();
    ctx.translate(textX, textY);
    ctx.rotate(textAngle + Math.PI / 2);
    
    // ë™ì  í°íŠ¸ í¬ê¸° ê³„ì‚°
    const fontSize = Math.max(10, Math.min(16, canvasInfo.radius / 10));
    
    // í…ìŠ¤íŠ¸ ê·¸ë¦¼ì
    ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
    ctx.font = `bold ${fontSize}px sans-serif`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(text, 1, 1);
    
    // ì‹¤ì œ í…ìŠ¤íŠ¸
    ctx.fillStyle = '#ffffff';
    ctx.fillText(text, 0, 0);
    
    ctx.restore();
};

// ì¤‘ì•™ ì› ê·¸ë¦¬ê¸°
const drawCenterCircle = () => {
    const centerRadius = Math.max(8, canvasInfo.radius / 15);
    
    ctx.fillStyle = '#374151';
    ctx.beginPath();
    ctx.arc(0, 0, centerRadius, 0, 2 * Math.PI);
    ctx.fill();
    
    ctx.strokeStyle = '#ffffff';
    ctx.lineWidth = Math.max(1, centerRadius / 8);
    ctx.stroke();
};

// ===================================================================
// [3. spin() í•¨ìˆ˜: ê°€ì¥ ì •í™•í•œ ëª©í‘œ ê³„ì‚° ë° ì‹¤í–‰]
// ===================================================================
const spin = () => {
    // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
    if (isSpinning || items.length === 0) return;
    
    isSpinning = true;
    updateSpinButtonState();
    updateArrowState('spinning');
    
    // ğŸ”„ ì¤‘ìš”: ìƒˆë¡œìš´ ìŠ¤í•€ ì‹œì‘ ì „ íšŒì „ ê°ë„ë¥¼ 0ìœ¼ë¡œ ë¦¬ì…‹ (ëˆ„ì  ì˜¤ë¥˜ ë°©ì§€)
    currentRotation = 0;
    drawRoulette(); // ë¦¬ì…‹ëœ ìƒíƒœë¡œ ëŒë¦¼íŒ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    
    console.log(`ğŸ”„ íšŒì „ ê°ë„ ë¦¬ì…‹: currentRotation = 0`);
    
    // 1ë‹¨ê³„: ìŠ¹ì ê²°ì • (ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ ì „)
    const winnerIndex = Math.floor(Math.random() * items.length);
    const winnerItem = items[winnerIndex];
    preSelectedWinner = { index: winnerIndex, item: winnerItem };
    
    console.log(`ğŸ¯ === ìŠ¹ì ê²°ì • ===`);
    console.log(`ğŸ† ìŠ¹ì: items[${winnerIndex}] = "${winnerItem}"`);
    
    // 2ë‹¨ê³„: ìµœì¢… ëª©í‘œ ê°ë„ ê³„ì‚° (í•­ìƒ 0ë„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°)
    const sliceAngle = (2 * Math.PI) / items.length;
    
    // ğŸ§® í•µì‹¬ ê³µì‹: ìŠ¹ì ì¡°ê°ì˜ ì¤‘ì•™ì´ 12ì‹œ ë°©í–¥ì— ì˜¤ê¸° ìœ„í•œ ìµœì¢… íšŒì „ ê°ë„
    // "10ë°”í€´ë¥¼ ëŒê³ , ìŠ¹ì ì¡°ê°ì˜ ì‹œì‘ì ê¹Œì§€ ë˜ê°ê³ , ë‹¤ì‹œ ì¡°ê°ì˜ ì ˆë°˜ë§Œí¼ ë” ë˜ê°ëŠ”"
    // í•­ìƒ 0ë„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í•˜ë¯€ë¡œ currentRotationì„ ë”í•˜ì§€ ì•ŠìŒ
    let winnerTargetRotation = (2 * Math.PI * 10) - (winnerIndex * sliceAngle) - (sliceAngle / 2);
    
    // ìì—°ìŠ¤ëŸ¬ì›€ì„ ìœ„í•œ ì•½ê°„ì˜ ëœë¤ ê°’ ì¶”ê°€ (ì¡°ê° ì¤‘ì•™ì— ì •í™•íˆ ë©ˆì¶”ì§€ ì•Šë„ë¡)
    const randomOffset = (Math.random() - 0.5) * (sliceAngle * 0.3); // Â±15% ëœë¤
    winnerTargetRotation += randomOffset;
    
    // ìµœì¢… ëª©í‘œ íšŒì „ (0ë„ì—ì„œ ì‹œì‘í•˜ë¯€ë¡œ currentRotation ë”í•˜ì§€ ì•ŠìŒ)
    const finalTargetRotation = winnerTargetRotation;
    
    console.log(`ğŸ“ ì¡°ê° í¬ê¸°: ${(sliceAngle * 180 / Math.PI).toFixed(1)}ë„`);
    console.log(`ğŸ¯ ëª©í‘œ íšŒì „: ${(winnerTargetRotation * 180 / Math.PI).toFixed(1)}ë„`);
    console.log(`ğŸš€ ìµœì¢… ëª©í‘œ: ${(finalTargetRotation * 180 / Math.PI).toFixed(1)}ë„`);
    
    // 3ë‹¨ê³„: ì• ë‹ˆë©”ì´ì…˜ ë° ê²°ê³¼ í‘œì‹œ
    startSpinAnimation(finalTargetRotation);
};

// ìŠ¤í•€ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
const startSpinAnimation = (targetRotation) => {
    const startRotation = currentRotation;
    const totalRotation = targetRotation - startRotation;
    const duration = 5000; // 5ì´ˆ
    const startTime = performance.now();
    
    console.log(`ğŸ¬ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ (${duration/1000}ì´ˆ, ${(totalRotation * 180 / Math.PI).toFixed(1)}ë„ íšŒì „)`);
    
    const animate = (currentTime) => {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // ë¶€ë“œëŸ½ê²Œ ê°ì†í•˜ëŠ” easing í•¨ìˆ˜
        const easedProgress = easeOutCubic(progress);
        
        // currentRotation ê°’ì„ ì—…ë°ì´íŠ¸
        currentRotation = startRotation + (totalRotation * easedProgress);
        
        // ë§¤ í”„ë ˆì„ë§ˆë‹¤ drawRoulette() í˜¸ì¶œ
        drawRoulette();
        
        if (progress < 1) {
            animationId = safeRequestAnimationFrame(animate);
        } else {
            // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ
            finishSpin();
        }
    };
    
    animationId = safeRequestAnimationFrame(animate);
};

// Easing í•¨ìˆ˜ (ì ì§„ì  ê°ì†)
const easeOutCubic = (t) => {
    return 1 - Math.pow(1 - t, 3);
};

// ìŠ¤í•€ ì™„ë£Œ ì²˜ë¦¬
const finishSpin = () => {
    isSpinning = false;
    animationId = null;
    
    console.log(`ğŸ›‘ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ`);
    console.log(`ğŸ“ ìµœì¢… ê°ë„: ${(currentRotation * 180 / Math.PI).toFixed(1)}ë„`);
    console.log(`ğŸ‰ ê²°ê³¼: "${preSelectedWinner.item}"`);
    
    // ê²°ê³¼ í‘œì‹œ (1ë‹¨ê³„ì—ì„œ ê²°ì •í•œ ìŠ¹ì ì‚¬ìš©, ë‹¤ì‹œ ê³„ì‚° ê¸ˆì§€)
    showResult(preSelectedWinner.item);
    
    // UI ìƒíƒœ ë³µì›
    updateSpinButtonState();
    updateArrowState('result');
    
    // í™”ì‚´í‘œ ê°•ì¡° íš¨ê³¼ ì œê±°
    setTimeout(() => {
        updateArrowState('normal');
    }, 2000);
};

// ===================================================================
// [4. reset() í•¨ìˆ˜: ë¦¬ì…‹ ê¸°ëŠ¥]
// ===================================================================
const reset = () => {
    // ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì´ë©´ ì¤‘ë‹¨
    if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
    }
    
    // ìƒíƒœ ì´ˆê¸°í™”
    items = []; // items ë°°ì—´ ë¹„ìš°ê¸°
    currentRotation = 0; // currentRotation = 0ìœ¼ë¡œ ì´ˆê¸°í™”
    isSpinning = false;
    preSelectedWinner = null;
    
    // UI ì—…ë°ì´íŠ¸
    updateItemsList();
    drawRoulette(); // ê¹¨ë—í•œ ëŒë¦¼íŒì„ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    updateSpinButtonState();
    updateSaveFavoriteButton(); // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    updateArrowState('normal');
    
    // ê²°ê³¼ í…ìŠ¤íŠ¸ ë¹„ìš°ê¸°
    resultElement.textContent = 'í•­ëª©ì„ ì¶”ê°€í•˜ê³  ëŒë¦¼íŒì„ ëŒë ¤ë³´ì„¸ìš”!';
    resultElement.className = 'text-center text-lg text-gray-600 min-h-[3rem] flex items-center justify-center';
    
    // ì¦ê²¨ì°¾ê¸° ì…ë ¥ì°½ ì´ˆê¸°í™”
    favoriteNameInput.value = '';
    
    // ì…ë ¥ì°½ í¬ì»¤ìŠ¤
    itemInput.focus();
    
    console.log(`ğŸ”„ === ë¦¬ì…‹ ì™„ë£Œ ===`);
    console.log(`âœ… ëª¨ë“  ìƒíƒœê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);
};

// ===================================================================
// [5. ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥]
// ===================================================================

// localStorageì—ì„œ ì¦ê²¨ì°¾ê¸° ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
const getFavorites = () => {
    try {
        const favorites = safeLocalStorage.getItem('roulette-favorites');
        return favorites ? JSON.parse(favorites) : [];
    } catch (error) {
        handleGlobalError(error, 'Storage');
        return [];
    }
};

// localStorageì— ì¦ê²¨ì°¾ê¸° ëª©ë¡ ì €ì¥
const setFavorites = (favorites) => {
    const success = safeLocalStorage.setItem('roulette-favorites', JSON.stringify(favorites));
    if (success) {
        console.log('ì¦ê²¨ì°¾ê¸° ì €ì¥ ì™„ë£Œ');
    } else {
        alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•˜ê±°ë‚˜ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¼ë¶€ ì¦ê²¨ì°¾ê¸°ë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”.');
    }
};

// í˜„ì¬ ëŒë¦¼íŒì„ ì¦ê²¨ì°¾ê¸°ë¡œ ì €ì¥
const saveFavorite = () => {
    const name = favoriteNameInput.value.trim();
    
    if (!name) {
        alert('ëŒë¦¼íŒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        favoriteNameInput.focus();
        return;
    }
    
    if (items.length === 0) {
        alert('ì €ì¥í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤!');
        return;
    }
    
    const favorites = getFavorites();
    
    // ë™ì¼í•œ ì´ë¦„ì´ ìˆëŠ”ì§€ í™•ì¸
    const existingIndex = favorites.findIndex(fav => fav.name === name);
    
    if (existingIndex !== -1) {
        const overwrite = confirm(`"${name}" ëŒë¦¼íŒì´ ì´ë¯¸ ìˆìŠµë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?`);
        if (!overwrite) {
            favoriteNameInput.focus();
            return;
        }
        // ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸
        favorites[existingIndex] = {
            name: name,
            items: [...items],
            createdAt: Date.now()
        };
    } else {
        // ìƒˆ í•­ëª© ì¶”ê°€
        favorites.push({
            name: name,
            items: [...items],
            createdAt: Date.now()
        });
    }
    
    setFavorites(favorites);
    favoriteNameInput.value = '';
    updateFavoritesList();
    updateSaveFavoriteButton();
    
    console.log(`ğŸ’¾ ì¦ê²¨ì°¾ê¸° ì €ì¥: "${name}" (${items.length}ê°œ í•­ëª©)`);
    
    // ì„±ê³µ ë©”ì‹œì§€
    const successMsg = document.createElement('div');
    successMsg.className = 'text-xs text-green-600 mt-1';
    successMsg.textContent = `âœ… "${name}" ì €ì¥ ì™„ë£Œ!`;
    favoriteNameInput.parentNode.appendChild(successMsg);
    
    setTimeout(() => {
        successMsg.remove();
    }, 2000);
};

// ì €ì¥ëœ ëŒë¦¼íŒ ë¶ˆëŸ¬ì˜¤ê¸°
const loadFavorite = (index) => {
    const favorites = getFavorites();
    
    if (index < 0 || index >= favorites.length) {
        alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¦ê²¨ì°¾ê¸°ì…ë‹ˆë‹¤.');
        return;
    }
    
    const favorite = favorites[index];
    
    // í˜„ì¬ í•­ëª©ì´ ìˆìœ¼ë©´ í™•ì¸
    if (items.length > 0) {
        const confirm = window.confirm(`í˜„ì¬ í•­ëª©ë“¤ì´ "${favorite.name}" ëŒë¦¼íŒìœ¼ë¡œ ë°”ë€ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
        if (!confirm) return;
    }
    
    // í•­ëª© ë¶ˆëŸ¬ì˜¤ê¸°
    items = [...favorite.items];
    
    // ëŒë¦¼íŒ ìƒíƒœ ì´ˆê¸°í™”
    currentRotation = 0;
    
    // UI ì—…ë°ì´íŠ¸
    updateItemsList();
    drawRoulette();
    updateSpinButtonState();
    
    // ê²°ê³¼ ì˜ì—­ ì´ˆê¸°í™”
    resultElement.textContent = 'í•­ëª©ì„ ì¶”ê°€í•˜ê³  ëŒë¦¼íŒì„ ëŒë ¤ë³´ì„¸ìš”!';
    resultElement.className = 'text-center text-lg text-gray-600 min-h-[3rem] flex items-center justify-center';
    
    console.log(`ğŸ“‚ ì¦ê²¨ì°¾ê¸° ë¶ˆëŸ¬ì˜¤ê¸°: "${favorite.name}" (${favorite.items.length}ê°œ í•­ëª©)`);
    
    // ì„±ê³µ ë©”ì‹œì§€
    const successMsg = document.createElement('div');
    successMsg.className = 'text-xs text-blue-600 mt-1 text-center';
    successMsg.textContent = `ğŸ“‚ "${favorite.name}" ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!`;
    favoritesList.appendChild(successMsg);
    
    setTimeout(() => {
        successMsg.remove();
    }, 2000);
};

// íŠ¹ì • ì¦ê²¨ì°¾ê¸° ì‚­ì œ
const deleteFavorite = (index) => {
    const favorites = getFavorites();
    
    if (index < 0 || index >= favorites.length) {
        alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¦ê²¨ì°¾ê¸°ì…ë‹ˆë‹¤.');
        return;
    }
    
    const favorite = favorites[index];
    const confirmDelete = confirm(`"${favorite.name}" ëŒë¦¼íŒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
    
    if (!confirmDelete) return;
    
    favorites.splice(index, 1);
    setFavorites(favorites);
    updateFavoritesList();
    
    console.log(`ğŸ—‘ï¸ ì¦ê²¨ì°¾ê¸° ì‚­ì œ: "${favorite.name}"`);
};

// ëª¨ë“  ì¦ê²¨ì°¾ê¸° ì‚­ì œ
const clearAllFavorites = () => {
    const favorites = getFavorites();
    
    if (favorites.length === 0) {
        alert('ì‚­ì œí•  ì¦ê²¨ì°¾ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    const confirmDelete = confirm(`ëª¨ë“  ì¦ê²¨ì°¾ê¸° ëŒë¦¼íŒ(${favorites.length}ê°œ)ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
    
    if (!confirmDelete) return;
    
    setFavorites([]);
    updateFavoritesList();
    
    console.log(`ğŸ—‘ï¸ ëª¨ë“  ì¦ê²¨ì°¾ê¸° ì‚­ì œ (${favorites.length}ê°œ)`);
    
    alert('ëª¨ë“  ì¦ê²¨ì°¾ê¸°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
};

// ì¦ê²¨ì°¾ê¸° ëª©ë¡ UI ì—…ë°ì´íŠ¸
const updateFavoritesList = () => {
    const favorites = getFavorites();
    favoritesList.innerHTML = '';
    
    if (favorites.length === 0) {
        favoritesList.innerHTML = '<div class="text-sm text-gray-400 text-center py-4 bg-gray-50 rounded-lg">ì €ì¥ëœ ëŒë¦¼íŒì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        clearAllFavoritesButton.style.display = 'none';
        return;
    }
    
    clearAllFavoritesButton.style.display = 'inline';
    
    favorites.forEach((favorite, index) => {
        const favoriteItem = document.createElement('div');
        favoriteItem.className = 'flex items-center justify-between bg-gray-50 px-4 py-3 rounded-xl shadow-sm';
        
        // ì•ˆì „í•˜ê²Œ ìš”ì†Œ ìƒì„±
        const mainDiv = document.createElement('div');
        mainDiv.className = 'flex-1 min-w-0';
        
        const nameDiv = document.createElement('div');
        nameDiv.className = 'text-base font-semibold text-gray-800 truncate';
        nameDiv.textContent = favorite.name; // XSS ë°©ì§€ë¥¼ ìœ„í•´ textContent ì‚¬ìš©
        
        const infoDiv = document.createElement('div');
        infoDiv.className = 'text-sm text-gray-500';
        infoDiv.textContent = `${favorite.items.length}ê°œ í•­ëª© â€¢ ${new Date(favorite.createdAt).toLocaleDateString()}`;
        
        mainDiv.appendChild(nameDiv);
        mainDiv.appendChild(infoDiv);
        
        const buttonsDiv = document.createElement('div');
        buttonsDiv.className = 'flex gap-2 ml-2';
        
        const loadBtn = document.createElement('button');
        loadBtn.className = 'load-favorite-btn px-3 py-2 bg-blue-500 text-white text-sm font-semibold rounded-lg hover:bg-blue-600 active:bg-blue-700 transition-colors';
        loadBtn.dataset.index = index;
        loadBtn.textContent = 'ğŸ“‚';
        loadBtn.setAttribute('aria-label', `${favorite.name} ëŒë¦¼íŒ ë¶ˆëŸ¬ì˜¤ê¸°`);
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-favorite-btn px-3 py-2 bg-red-500 text-white text-sm font-semibold rounded-lg hover:bg-red-600 active:bg-red-700 transition-colors';
        deleteBtn.dataset.index = index;
        deleteBtn.textContent = 'ğŸ—‘ï¸';
        deleteBtn.setAttribute('aria-label', `${favorite.name} ëŒë¦¼íŒ ì‚­ì œ`);
        
        buttonsDiv.appendChild(loadBtn);
        buttonsDiv.appendChild(deleteBtn);
        
        favoriteItem.appendChild(mainDiv);
        favoriteItem.appendChild(buttonsDiv);
        
        favoritesList.appendChild(favoriteItem);
    });
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.querySelectorAll('.load-favorite-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const index = parseInt(e.target.dataset.index);
            loadFavorite(index);
        });
    });
    
    document.querySelectorAll('.delete-favorite-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const index = parseInt(e.target.dataset.index);
            deleteFavorite(index);
        });
    });
};

// ì €ì¥ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
const updateSaveFavoriteButton = () => {
    const hasItems = items.length > 0;
    const hasName = favoriteNameInput.value.trim().length > 0;
    
    saveFavoriteButton.disabled = !hasItems || !hasName;
};

// ===================================================================
// [6. ê¸°íƒ€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤]
// ===================================================================

// í•­ëª© ì¶”ê°€
const addItem = () => {
    try {
        const value = validateAndSanitizeInput(itemInput.value);
        
        if (!value) {
            alert('í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            itemInput.focus();
            return;
        }
        
        if (items.includes(value)) {
            alert('ì´ë¯¸ ì¶”ê°€ëœ í•­ëª©ì…ë‹ˆë‹¤!');
            itemInput.focus();
            return;
        }
        
        if (items.length >= 20) {
            alert('ìµœëŒ€ 20ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
            return;
        }
    } catch (error) {
        alert(error.message);
        itemInput.focus();
        return;
    }
    
    items.push(value);
    itemInput.value = '';
    itemInput.focus();
    
    // ğŸ”„ í•­ëª© ì¶”ê°€ í›„ ëŒë¦¼íŒ ê°ë„ë¥¼ 0ìœ¼ë¡œ ë¦¬ì…‹ (êµ¬ì„± ë³€ê²½ìœ¼ë¡œ ì¸í•œ ì˜¤ë¥˜ ë°©ì§€)
    currentRotation = 0;
    
    updateItemsList();
    drawRoulette(); // ì´ˆê¸° ìƒíƒœë¡œ ëŒë¦¼íŒ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    updateSpinButtonState();
    updateSaveFavoriteButton(); // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    enhanceRouletteAccessibility(); // ìº”ë²„ìŠ¤ ì ‘ê·¼ì„± ì—…ë°ì´íŠ¸
    
    // ì ‘ê·¼ì„± ì•Œë¦¼
    announceToScreenReader(`"${value}" í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ${items.length}ê°œ í•­ëª©`);
    
    console.log(`â• í•­ëª© ì¶”ê°€: "${value}" (ì´ ${items.length}ê°œ)`);
    console.log(`ğŸ”„ ëŒë¦¼íŒ ê°ë„ ë¦¬ì…‹: currentRotation = 0`);
};

// í•­ëª© ì‚­ì œ
const removeItem = (index) => {
    const removedItem = items[index];
    items.splice(index, 1);
    
    // ğŸ”„ í•­ëª© ì œê±° í›„ ëŒë¦¼íŒ ê°ë„ë¥¼ 0ìœ¼ë¡œ ë¦¬ì…‹ (êµ¬ì„± ë³€ê²½ìœ¼ë¡œ ì¸í•œ ì˜¤ë¥˜ ë°©ì§€)
    currentRotation = 0;
    
    updateItemsList();
    drawRoulette(); // ì´ˆê¸° ìƒíƒœë¡œ ëŒë¦¼íŒ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    updateSpinButtonState();
    updateSaveFavoriteButton(); // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    enhanceRouletteAccessibility(); // ìº”ë²„ìŠ¤ ì ‘ê·¼ì„± ì—…ë°ì´íŠ¸
    
    if (items.length === 0) {
        resultElement.textContent = 'í•­ëª©ì„ ì¶”ê°€í•˜ê³  ëŒë¦¼íŒì„ ëŒë ¤ë³´ì„¸ìš”!';
        resultElement.className = 'text-center text-lg text-gray-600 min-h-[3rem] flex items-center justify-center';
    }
    
    // ì ‘ê·¼ì„± ì•Œë¦¼
    announceToScreenReader(`"${removedItem}" í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ${items.length > 0 ? `ì´ ${items.length}ê°œ í•­ëª©` : 'í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤'}`);
    
    console.log(`â– í•­ëª© ì œê±°: "${removedItem}" (ì´ ${items.length}ê°œ)`);
    console.log(`ğŸ”„ ëŒë¦¼íŒ ê°ë„ ë¦¬ì…‹: currentRotation = 0`);
};

// í•­ëª© ëª©ë¡ UI ì—…ë°ì´íŠ¸
const updateItemsList = () => {
    itemsList.innerHTML = '';
    
    if (items.length === 0) {
        itemsList.innerHTML = '<span class="text-gray-400 text-sm">ì•„ì§ ì¶”ê°€ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</span>';
        return;
    }
    
    items.forEach((item, index) => {
        const tag = document.createElement('div');
        tag.className = 'item-tag';
        // ì•ˆì „í•˜ê²Œ ìš”ì†Œ ìƒì„±
        const itemSpan = document.createElement('span');
        itemSpan.textContent = item; // XSS ë°©ì§€ë¥¼ ìœ„í•´ textContent ì‚¬ìš©
        
        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-btn';
        removeBtn.textContent = 'Ã—';
        removeBtn.setAttribute('aria-label', `${item} ì‚­ì œ`);
        removeBtn.setAttribute('title', `${item} ì‚­ì œ`);
        removeBtn.addEventListener('click', () => removeItem(index));
        
        tag.appendChild(itemSpan);
        tag.appendChild(removeBtn);
        itemsList.appendChild(tag);
    });
    
    // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ (í•­ëª© ëª©ë¡ì´ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ)
    updateSaveFavoriteButton();
};

// ëŒë¦¬ê¸° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
const updateSpinButtonState = () => {
    const shouldDisable = items.length === 0 || isSpinning;
    spinButton.disabled = shouldDisable;
    
    if (isSpinning) {
        spinButton.textContent = 'ëŒë¦¬ëŠ” ì¤‘...';
        spinButton.classList.add('animate-pulse');
    } else {
        spinButton.innerHTML = `
            <div class="flex items-center justify-center gap-2">
                <span>ğŸ¯</span>
                <span>ëŒë¦¬ê¸°!</span>
            </div>
        `;
        spinButton.classList.remove('animate-pulse');
    }
};

// í™”ì‚´í‘œ ìƒíƒœ ì—…ë°ì´íŠ¸
const updateArrowState = (state) => {
    arrowPointer.classList.remove('spinning', 'result');
    
    if (state === 'spinning') {
        arrowPointer.classList.add('spinning');
    } else if (state === 'result') {
        arrowPointer.classList.add('result');
    }
};

// ê²°ê³¼ í‘œì‹œ
const showResult = (selectedItem) => {
    resultElement.textContent = `ğŸ¯ ê²°ê³¼: ${selectedItem}`;
    resultElement.className = 'text-center result-highlight min-h-[3rem] flex items-center justify-center';
    
    // ì ‘ê·¼ì„±ì„ ìœ„í•œ ìŠ¤í¬ë¦° ë¦¬ë” ì•Œë¦¼
    setTimeout(() => {
        const announcement = document.createElement('div');
        announcement.className = 'sr-only';
        announcement.setAttribute('aria-live', 'assertive');
        announcement.textContent = `ëŒë¦¼íŒì´ ë©ˆì·„ìŠµë‹ˆë‹¤! ì„ íƒëœ í•­ëª©ì€ ${selectedItem}ì…ë‹ˆë‹¤.`;
        document.body.appendChild(announcement);
        
        setTimeout(() => {
            document.body.removeChild(announcement);
        }, 1000);
    }, 100);
};

// ì…ë ¥ì°½ í‚¤ ì´ë²¤íŠ¸ ì²˜ë¦¬
const handleKeyPress = (event) => {
    if (event.key === 'Enter') {
        addItem();
    }
};

// ===================================================================
// ğŸŒ ì ‘ê·¼ì„± ê°œì„  - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ë° ARIA ì§€ì›
// ===================================================================

// í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ í•¸ë“¤ëŸ¬
const handleGlobalKeyDown = (event) => {
    // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤ê°€ ìˆì„ ë•ŒëŠ” ê¸°ë³¸ ë™ì‘ ìœ ì§€
    if (event.target.tagName === 'INPUT') {
        return;
    }
    
    // Ctrl/Cmd + Enter: ëŒë¦¼íŒ ëŒë¦¬ê¸°
    if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
        event.preventDefault();
        if (!spinButton.disabled) {
            spin();
        }
        return;
    }
    
    // Space ë˜ëŠ” Enter: í¬ì»¤ìŠ¤ëœ ë²„íŠ¼ í´ë¦­
    if ((event.key === ' ' || event.key === 'Enter') && 
        event.target.tagName === 'BUTTON') {
        event.preventDefault();
        event.target.click();
        return;
    }
    
    // Escape: ëª¨ë‹¬ ë‹«ê¸° (ë§Œì•½ ìˆë‹¤ë©´)
    if (event.key === 'Escape') {
        const modal = document.querySelector('[style*="position: fixed"]');
        if (modal) {
            modal.remove();
        }
        return;
    }
};

// ë²„íŠ¼ í¬ì»¤ìŠ¤ ê°€ì‹œì„± ê°œì„ 
const enhanceButtonFocus = () => {
    const buttons = document.querySelectorAll('button');
    buttons.forEach(button => {
        button.addEventListener('focus', () => {
            button.style.outline = '2px solid #3b82f6';
            button.style.outlineOffset = '2px';
        });
        
        button.addEventListener('blur', () => {
            button.style.outline = '';
            button.style.outlineOffset = '';
        });
    });
};

// ëŒë¦¼íŒ ì˜ì—­ í‚¤ë³´ë“œ ì ‘ê·¼ì„±
const enhanceRouletteAccessibility = () => {
    canvas.setAttribute('tabindex', '0');
    canvas.setAttribute('role', 'img');
    canvas.setAttribute('aria-label', `ëŒë¦¼íŒ (${items.length}ê°œ í•­ëª©)`);
    
    canvas.addEventListener('keydown', (event) => {
        if ((event.key === 'Enter' || event.key === ' ') && !spinButton.disabled) {
            event.preventDefault();
            spin();
        }
    });
};

// ìŠ¤í¬ë¦° ë¦¬ë”ë¥¼ ìœ„í•œ ìƒíƒœ ì•Œë¦¼
const announceToScreenReader = (message) => {
    const announcement = document.createElement('div');
    announcement.className = 'sr-only';
    announcement.setAttribute('aria-live', 'polite');
    announcement.setAttribute('aria-atomic', 'true');
    announcement.textContent = message;
    
    document.body.appendChild(announcement);
    
    setTimeout(() => {
        if (announcement.parentElement) {
            document.body.removeChild(announcement);
        }
    }, 1000);
};

// ===================================================================
// ğŸ”— ê°„í¸ ë§í¬ ë³µì‚¬ ê¸°ëŠ¥
// ===================================================================

// ê³µìœ  ë²„íŠ¼ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
const shareButton = document.getElementById('share-button');

// ê³µìœ  ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (í´ë¦½ë³´ë“œ ë³µì‚¬)
shareButton.addEventListener('click', async () => {
    try {
        // í˜„ì¬ í˜ì´ì§€ URL ë³µì‚¬
        const currentUrl = window.location.href;
        
        if (navigator.clipboard) {
            // ëª¨ë˜ ë¸Œë¼ìš°ì €: Clipboard API ì‚¬ìš©
            await navigator.clipboard.writeText(currentUrl);
            showCopySuccess();
            console.log('ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬ ì„±ê³µ:', currentUrl);
        } else {
            // êµ¬í˜• ë¸Œë¼ìš°ì €: ìˆ˜ë™ ë³µì‚¬
            const textArea = document.createElement('textarea');
            textArea.value = currentUrl;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showCopySuccess();
            console.log('ğŸ“‹ ìˆ˜ë™ ë³µì‚¬ ì„±ê³µ:', currentUrl);
        }
    } catch (error) {
        console.warn('âš ï¸ í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', error);
        // ë³µì‚¬ ì‹¤íŒ¨ ì‹œ URLì„ ì§ì ‘ ë³´ì—¬ì£¼ê¸°
        alert(`ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì•„ë˜ ì£¼ì†Œë¥¼ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”:\n\n${window.location.href}`);
    }
});

// ë³µì‚¬ ì„±ê³µ ì•Œë¦¼ í‘œì‹œ
const showCopySuccess = () => {
    // ì‹œê°ì  í”¼ë“œë°±ì„ ìœ„í•´ ë²„íŠ¼ ìƒ‰ìƒ ì ì‹œ ë³€ê²½
    const originalClass = shareButton.className;
    shareButton.className = shareButton.className.replace('bg-blue-500', 'bg-green-500');
    shareButton.className = shareButton.className.replace('hover:bg-blue-600', 'hover:bg-green-600');
    
    // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì ì‹œ ë³€ê²½
    const buttonText = shareButton.querySelector('span:last-child');
    const originalText = buttonText.textContent;
    buttonText.textContent = 'ë³µì‚¬ë¨!';
    
    // ì„±ê³µ ë©”ì‹œì§€
    alert('ğŸ”— ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\në©”ì‹ ì €ë‚˜ ë‹¤ë¥¸ ì•±ì—ì„œ ë¶™ì—¬ë„£ê¸°í•˜ì—¬ ê³µìœ í•´ë³´ì„¸ìš”.');
    
    // 1.5ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
    setTimeout(() => {
        shareButton.className = originalClass;
        buttonText.textContent = originalText;
    }, 1500);
};

// ===================================================================
// âš¡ ì„±ëŠ¥ ìµœì í™” ì‹œìŠ¤í…œ
// ===================================================================

// Debounce í•¨ìˆ˜ (ê³¼ë„í•œ í˜¸ì¶œ ë°©ì§€)
const debounce = (func, wait) => {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
};

// Throttle í•¨ìˆ˜ (ì• ë‹ˆë©”ì´ì…˜ ìµœì í™”)
const throttle = (func, limit) => {
    let lastFunc;
    let lastRan;
    return function(...args) {
        if (!lastRan) {
            func.apply(this, args);
            lastRan = Date.now();
        } else {
            clearTimeout(lastFunc);
            lastFunc = setTimeout(() => {
                if ((Date.now() - lastRan) >= limit) {
                    func.apply(this, args);
                    lastRan = Date.now();
                }
            }, limit - (Date.now() - lastRan));
        }
    };
};

// ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
const monitorMemory = () => {
    if (performance.memory) {
        const memory = performance.memory;
        console.log(`ğŸ“Š ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${(memory.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB / ${(memory.totalJSHeapSize / 1024 / 1024).toFixed(2)}MB`);
        
        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë„ˆë¬´ ë†’ìœ¼ë©´ ê²½ê³ 
        if (memory.usedJSHeapSize / memory.totalJSHeapSize > 0.9) {
            console.warn('âš ï¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë†’ìŠµë‹ˆë‹¤. ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì„ ê³ ë ¤í•˜ì„¸ìš”.');
        }
    }
};

// DOM ì—…ë°ì´íŠ¸ ìµœì í™”ë¥¼ ìœ„í•œ ë°°ì¹˜ ì²˜ë¦¬
const batchDOMUpdates = (updates) => {
    requestAnimationFrame(() => {
        updates.forEach(update => update());
    });
};

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬ë¥¼ ìœ„í•œ WeakMap
const eventListeners = new WeakMap();

// ì•ˆì „í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
const addSafeEventListener = (element, event, handler, options = {}) => {
    try {
        element.addEventListener(event, handler, options);
        
        // ì •ë¦¬ë¥¼ ìœ„í•´ ì €ì¥
        if (!eventListeners.has(element)) {
            eventListeners.set(element, []);
        }
        eventListeners.get(element).push({ event, handler, options });
        
    } catch (error) {
        handleGlobalError(error, 'Event');
    }
};

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬
const cleanupEventListeners = (element) => {
    const listeners = eventListeners.get(element);
    if (listeners) {
        listeners.forEach(({ event, handler, options }) => {
            try {
                element.removeEventListener(event, handler, options);
            } catch (error) {
                console.warn('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬ ì‹¤íŒ¨:', error);
            }
        });
        eventListeners.delete(element);
    }
};

// ===================================================================
// ğŸ›¡ï¸ ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬ ì‹œìŠ¤í…œ
// ===================================================================

// ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬
const handleGlobalError = (error, context = 'Unknown') => {
    console.error(`âŒ [${context}] ì˜¤ë¥˜ ë°œìƒ:`, error);
    
    // ì‚¬ìš©ìì—ê²Œ ì¹œí™”ì ì¸ ë©”ì‹œì§€ í‘œì‹œ
    const errorMessages = {
        'Canvas': 'ëŒë¦¼íŒ í‘œì‹œì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.',
        'Storage': 'ì €ì¥ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.',
        'Animation': 'ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.',
        'Input': 'ì…ë ¥ ì²˜ë¦¬ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.',
        'Network': 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'
    };
    
    const message = errorMessages[context] || 'ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
    
    // ì¹˜ëª…ì ì´ì§€ ì•Šì€ ì˜¤ë¥˜ëŠ” ì½˜ì†”ì—ë§Œ ê¸°ë¡
    if (context === 'Animation' || context === 'Network') {
        return;
    }
    
    // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
    setTimeout(() => {
        alert(`âš ï¸ ${message}\n\në¬¸ì œê°€ ê³„ì†ë˜ë©´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.`);
    }, 100);
};

// ìº”ë²„ìŠ¤ ì´ˆê¸°í™” ì•ˆì „ ê²€ì‚¬
const safeInitializeCanvas = () => {
    try {
        if (!canvas || !ctx) {
            throw new Error('Canvas ë˜ëŠ” Contextë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
        
        return initializeCanvas();
    } catch (error) {
        handleGlobalError(error, 'Canvas');
        
        // ê¸°ë³¸ê°’ ë°˜í™˜
        return {
            centerX: 140,
            centerY: 140,
            radius: 120
        };
    }
};

// localStorage ì•ˆì „ ì ‘ê·¼
const safeLocalStorage = {
    getItem: (key) => {
        try {
            return localStorage.getItem(key);
        } catch (error) {
            handleGlobalError(error, 'Storage');
            return null;
        }
    },
    
    setItem: (key, value) => {
        try {
            localStorage.setItem(key, value);
            return true;
        } catch (error) {
            handleGlobalError(error, 'Storage');
            return false;
        }
    },
    
    removeItem: (key) => {
        try {
            localStorage.removeItem(key);
            return true;
        } catch (error) {
            handleGlobalError(error, 'Storage');
            return false;
        }
    }
};

// ì‚¬ìš©ì ì…ë ¥ ê²€ì¦ ë° ì •ì œ
const validateAndSanitizeInput = (input) => {
    if (typeof input !== 'string') {
        throw new Error('ì…ë ¥ê°’ì´ ë¬¸ìì—´ì´ ì•„ë‹™ë‹ˆë‹¤');
    }
    
    // ê³µë°± ì œê±°
    const trimmed = input.trim();
    
    // ê¸¸ì´ ê²€ì¦ (ìµœëŒ€ 50ì)
    if (trimmed.length > 50) {
        throw new Error('í•­ëª© ì´ë¦„ì€ 50ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    }
    
    // íŠ¹ìˆ˜ë¬¸ì ì œí•œ (ê¸°ë³¸ì ì¸ ë¬¸ì, ìˆ«ì, í•œê¸€, ê³µë°±ë§Œ í—ˆìš©)
    const allowedPattern = /^[a-zA-Z0-9ê°€-í£ã„±-ã…ã…-ã…£\s\-_().]+$/;
    if (!allowedPattern.test(trimmed)) {
        throw new Error('í—ˆìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤');
    }
    
    return trimmed;
};

// ì• ë‹ˆë©”ì´ì…˜ ì•ˆì „ ì‹¤í–‰
const safeRequestAnimationFrame = (callback) => {
    try {
        return requestAnimationFrame(callback);
    } catch (error) {
        handleGlobalError(error, 'Animation');
        // í´ë°±: setTimeout ì‚¬ìš©
        return setTimeout(callback, 16); // ~60fps
    }
};

// ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸° ì•ˆì „ ì‹¤í–‰
const safeDrawRoulette = () => {
    try {
        drawRoulette();
    } catch (error) {
        handleGlobalError(error, 'Canvas');
        
        // ìº”ë²„ìŠ¤ ë³µêµ¬ ì‹œë„
        try {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#f3f4f6';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#9ca3af';
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ëŒë¦¼íŒ í‘œì‹œ ì˜¤ë¥˜', canvas.width / 2, canvas.height / 2);
        } catch (fallbackError) {
            console.error('ìº”ë²„ìŠ¤ ë³µêµ¬ ì‹¤íŒ¨:', fallbackError);
        }
    }
};

// ===================================================================
// [7. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ë° ì´ˆê¸°í™”]
// ===================================================================
document.addEventListener('DOMContentLoaded', () => {
    // ğŸš€ ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€ ë° ì²˜ë¦¬ (ìµœìš°ì„  ì‹¤í–‰)
    const isKakaoInApp = handleKakaoInAppBrowser();
    if (isKakaoInApp) {
        console.log('âš ï¸ ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € í™˜ê²½ - ì¼ë¶€ ê¸°ëŠ¥ ì œí•œ ê°€ëŠ¥');
    }
    
    // ìº”ë²„ìŠ¤ í¬ê¸° ì´ˆê¸°í™” (ì•ˆì „)
    canvasInfo = safeInitializeCanvas();
    
    // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë“±ë¡
    window.addEventListener('error', (event) => {
        handleGlobalError(event.error, 'Global');
    });
    
    window.addEventListener('unhandledrejection', (event) => {
        handleGlobalError(event.reason, 'Promise');
    });
    
    // 'ì¶”ê°€', 'ëŒë¦¬ê¸°!', 'ë¦¬ì…‹' ë²„íŠ¼ì— ê°ê°ì˜ í•¨ìˆ˜ë¥¼ ì •í™•íˆ ì—°ê²°
    addButton.addEventListener('click', addItem);
    spinButton.addEventListener('click', spin);
    resetButton.addEventListener('click', reset);
    itemInput.addEventListener('keypress', handleKeyPress);
    
    // ì¦ê²¨ì°¾ê¸° ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
    saveFavoriteButton.addEventListener('click', saveFavorite);
    clearAllFavoritesButton.addEventListener('click', clearAllFavorites);
    favoriteNameInput.addEventListener('input', updateSaveFavoriteButton);
    favoriteNameInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            saveFavorite();
        }
    });
    
    // í™”ë©´ íšŒì „ ë° ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘ (ì„±ëŠ¥ ìµœì í™”)
    const debouncedResize = debounce(() => {
        canvasInfo = safeInitializeCanvas();
        safeDrawRoulette();
    }, 150);
    
    window.addEventListener('resize', debouncedResize);
    
    // í™”ë©´ ë°©í–¥ ë³€ê²½ ëŒ€ì‘
    window.addEventListener('orientationchange', debouncedResize);
    
    // ì´ˆê¸° ìƒíƒœ ì„¤ì •
    currentRotation = 0;
    isSpinning = false;
    preSelectedWinner = null;
    
    // ì´ˆê¸° UI ì—…ë°ì´íŠ¸
    safeDrawRoulette();
    updateItemsList();
    updateSpinButtonState();
    updateSaveFavoriteButton();
    updateFavoritesList();
    
    // ì ‘ê·¼ì„± ê¸°ëŠ¥ í™œì„±í™”
    document.addEventListener('keydown', handleGlobalKeyDown);
    enhanceButtonFocus();
    enhanceRouletteAccessibility();
    
    // ì´ˆê¸° í¬ì»¤ìŠ¤ (ëª¨ë°”ì¼ì—ì„œëŠ” ìë™ í¬ì»¤ìŠ¤ ë°©ì§€)
    if (window.innerWidth > 768) {
        itemInput.focus();
    }
    
    // ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œì‘
    monitorMemory();
    setInterval(monitorMemory, 30000); // 30ì´ˆë§ˆë‹¤ ë©”ëª¨ë¦¬ ì²´í¬
    
    console.log(`ğŸª === ì „ë¬¸ê°€ê¸‰ PWA ëŒë¦¼íŒ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ ===`);
    console.log(`ğŸ“± ì™„ì „ ë°˜ì‘í˜• ëª¨ë°”ì¼ ìµœì í™” (vw/vh ê¸°ë°˜)`);
    console.log(`ğŸš€ ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ìë™ ì „í™˜ ì§€ì›`);
    console.log(`ğŸ“ ìˆ˜í•™ì ìœ¼ë¡œ ì™„ë²½í•œ ê³„ì‚°ì‹ ì ìš©`);
    console.log(`ğŸ¯ ì™„ì „ ë¶„ë¦¬ëœ ë¡œì§ (drawRoulette + spin + reset)`);
    console.log(`âœ… 100% ì •í™•í•œ ê²°ê³¼ ë³´ì¥`);
    console.log(`ğŸ”„ ë¦¬ì…‹ ê¸°ëŠ¥ ì¶”ê°€`);
    console.log(`ğŸ’¾ ì¦ê²¨ì°¾ê¸° ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥ ì¶”ê°€`);
    console.log(`ğŸ”— ê°„í¸ ë§í¬ ë³µì‚¬ ê³µìœ  ê¸°ëŠ¥`);
    console.log(`ğŸ¨ ë™ì  ë·°í¬íŠ¸ í¬ê¸° ì¡°ì • ì‹œìŠ¤í…œ`);
    console.log(`ğŸ›¡ï¸ ê°•í™”ëœ ë³´ì•ˆ ë° ì—ëŸ¬ ì²˜ë¦¬`);
    console.log(`ğŸŒ ì ‘ê·¼ì„± ê°œì„  (í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜, ARIA)`);
    console.log(`âš¡ ì„±ëŠ¥ ìµœì í™” (debounce, throttle, ë©”ëª¨ë¦¬ ê´€ë¦¬)`);
    console.log(`ğŸ“ ìº”ë²„ìŠ¤ í¬ê¸°: ${canvasInfo.centerX * 2}x${canvasInfo.centerY * 2}px`);
    console.log(`ğŸŒ í™”ë©´ í¬ê¸°: ${window.innerWidth}x${window.innerHeight}px`);
    console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n`);
});

// ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (HTMLì—ì„œ í˜¸ì¶œìš©)
window.removeItem = removeItem; 

console.log('ğŸ”— ë§í¬ ë³µì‚¬ ê¸°ëŠ¥ í™œì„±í™”ë¨ - ëª¨ë“  ë¸Œë¼ìš°ì € ì§€ì›');
    </script>
    
    <!-- PWA Service Worker ë“±ë¡ -->
    <script>
        // Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            });
        }

        // PWA ì„¤ì¹˜ ë°°ë„ˆ
        let deferredPrompt;
        const installButton = document.createElement('button');
        installButton.textContent = 'ì•± ì„¤ì¹˜';
        installButton.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-green-600 transition-colors z-50';
        installButton.style.display = 'none';

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA ì„¤ì¹˜ ë°°ë„ˆ ì¤€ë¹„ë¨');
            e.preventDefault();
            deferredPrompt = e;
            
            // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ
            document.body.appendChild(installButton);
            installButton.style.display = 'block';
        });

        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`ì‚¬ìš©ì ì„ íƒ: ${outcome}`);
                
                if (outcome === 'accepted') {
                    console.log('PWA ì„¤ì¹˜ë¨');
                }
                
                deferredPrompt = null;
                installButton.style.display = 'none';
            }
        });

        // ì•±ì´ ì„¤ì¹˜ëœ í›„
        window.addEventListener('appinstalled', () => {
            console.log('PWAê°€ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
            installButton.style.display = 'none';
            deferredPrompt = null;
        });

        // PWA ì‹¤í–‰ ê°ì§€
        window.addEventListener('DOMContentLoaded', () => {
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('PWA ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘');
                // PWA ëª¨ë“œì—ì„œë§Œ ë³´ì´ëŠ” ê¸°ëŠ¥ ì¶”ê°€ ê°€ëŠ¥
            }
        });
    </script>
</body>
</html> 